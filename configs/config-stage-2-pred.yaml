seed_everything: 8089
trainer:
  accelerator: auto
  strategy:  ddp_find_unused_parameters_true
  devices: auto
  num_nodes: 1
  precision: 16-mixed
  logger: 
    # - class_path: lightning.pytorch.loggers.NeptuneLogger
    #   init_args:
    #     project: st-andrews-droncogene/chexfusion++
    #     name: 384, tiny, baseline
    #     log_model_checkpoints: false
    - class_path: lightning.pytorch.loggers.TensorBoardLogger
      init_args:
        save_dir: .out/tb/
        name: stage-2
  callbacks:
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        dirpath: checkpoints/fusion
        filename: '{epoch:02d}-{val_loss:.4f}-{val_ap:.5f}'
        save_top_k: 10
        monitor: val_ap
        mode: max
    # - class_path: callbacks.submit_callback.SubmissonWriter
    #   init_args:
    #       write_interval: epoch
    #       sample_submission_path: data/sample_submission.csv
    #       submission_path: save/submission.csv        
    #       submission_zip_path: save/submission.zip
    #       submission_code_dir: data/code      
    #       pred_df_path: data/development.csv  
    # - class_path: callbacks.fusion_submit_callback.FusionSubmissonWriter
    #   init_args:
    #       write_interval: epoch
    #       sample_submission_path: data/sample_submission.csv
    #       submission_path: save/submission.csv        
    #       submission_zip_path: save/submission.zip
    #       submission_code_dir: data/code      
    #       tasks_df_paths:
    #         - data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_labeled_task1.csv
    #         - data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_labeled_task2.csv
    #       zero_shot_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_task3.csv 
    # - class_path: src.callbacks.vinbig_pseudo_callback.VinBigWriter
    #   init_args:
    #       write_interval: epoch
    #       vinbig_train_df_path: data/vinbig-cxr/train_expanded.csv
    #       vinbig_pseudo_train_df_path: data/vinbig-cxr/train_expanded_pseudo.csv
    # - class_path: src.callbacks.nih_pseudo_callback.NIHWriter 
    #   init_args:
    #       write_interval: epoch
    #       nih_train_df_path: data/nih-cxr/train_expanded.csv
    #       nih_pseudo_train_df_path: data/nih-cxr/train_expanded_pseudo.csv
    # - class_path: src.callbacks.chexpert_pseudo_callback.ChexpertWriter 
    #   init_args:
    #       write_interval: epoch
    #       chexpert_train_df_path: data/chexpert/CheXpert-v1.0/train_expanded.csv
    #       chexpert_pseudo_train_df_path: data/chexpert/CheXpert-v1.0/train_expanded_pseudo.csv
    # - class_path: lightning.pytorch.callbacks.StochasticWeightAveraging
    #   init_args:
    #     swa_lrs: 1e-2
    - class_path: lightning.pytorch.callbacks.early_stopping.EarlyStopping
      init_args:
        monitor: val_ap
        mode: max
        patience: 10
  fast_dev_run: false
  overfit_batches: 0.0
  val_check_interval: 0.25
  num_sanity_val_steps: 2
  accumulate_grad_batches: 1
  gradient_clip_val: null 
  deterministic: null
  benchmark: true
  max_epochs: 150
model:
  lr: 3e-5
  pretrained_path: checkpoints/backbones/model.pth
  classes: 
    - Adenopathy
    - Atelectasis
    - Azygos Lobe
    - Calcification of the Aorta
    - Cardiomegaly
    - Clavicle Fracture
    - Consolidation
    - Edema
    - Emphysema
    - Enlarged Cardiomediastinum
    - Fibrosis
    - Fissure
    - Fracture
    - Granuloma
    - Hernia
    - Hydropneumothorax
    - Infarction
    - Infiltration
    - Kyphosis
    - Lobar Atelectasis
    - Lung Lesion
    - Lung Opacity
    - Mass
    - Nodule
    - Normal
    - Pleural Effusion
    - Pleural Other
    - Pleural Thickening
    - Pneumomediastinum
    - Pneumonia
    - Pneumoperitoneum
    - Pneumothorax
    - Pulmonary Embolism
    - Pulmonary Hypertension
    - Rib Fracture
    - Round(ed) Atelectasis
    - Subcutaneous Emphysema
    - Support Devices
    - Tortuous Aorta
    - Tuberculosis
  loss_init_args:
    type: asl
    class_instance_nums:
      - 3409
      - 65376
      - 199
      - 4239
      - 74738
      - 168
      - 15371
      - 37256
      - 3661
      - 29628
      - 1169
      - 2803
      - 11568
      - 2965
      - 3986
      - 646
      - 727
      - 10087
      - 778
      - 129
      - 2338
      - 77482
      - 5288
      - 7531
      - 34292
      - 66401
      - 616
      - 3272
      - 704
      - 46660
      - 516
      - 13858
      - 1631
      - 903
      - 8919
      - 172
      - 2046
      - 86079
      - 3336
      - 2078
    total_instance_num: 258871
  timm_init_args:
    num_classes: 40
    model_name: convnext_tiny.fb_in22k_ft_in1k_384
    pretrained: true
data:
  dataloader_init_args:
    batch_size: 16
    num_workers: 8
    pin_memory: true
    persistent_workers: true
  datamodule_cfg: 
    predict_pseudo_label: null  # chexpert, nih, vinbig
    use_pseudo_label: false  # true, false
    loader_type: fusion  # single, fusion
    data_dir: data/
    resized_dir: data-resized/
    pred_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_labeled_task1.csv
    train_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/train_labeled.csv
    task1_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_labeled_task1.csv
    task2_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_labeled_task2.csv
    zero_shot_df_path: data/cxr-lt-iccv-workshop-cvamd/2.0.0/cxr-lt-2024/development_task3.csv
    vinbig_train_df_path: data/vinbig-cxr/train_expanded.csv
    vinbig_pseudo_train_df_path: data/vinbig-cxr/train_expanded_pseudo.csv
    nih_train_df_path: data/nih-cxr/train_expanded.csv
    nih_pseudo_train_df_path: data/nih-cxr/train_expanded_pseudo.csv
    chexpert_train_df_path: data/chexpert/CheXpert-v1.0/train_expanded.csv
    chexpert_pseudo_train_df_path: data/chexpert/CheXpert-v1.0/train_expanded_pseudo.csv
    save_dir: checkpoints
    val_split: 0.1
    seed: 8089
    size: 384
    classes: 
      - Adenopathy
      - Atelectasis
      - Azygos Lobe
      - Calcification of the Aorta
      - Cardiomegaly
      - Clavicle Fracture
      - Consolidation
      - Edema
      - Emphysema
      - Enlarged Cardiomediastinum
      - Fibrosis
      - Fissure
      - Fracture
      - Granuloma
      - Hernia
      - Hydropneumothorax
      - Infarction
      - Infiltration
      - Kyphosis
      - Lobar Atelectasis
      - Lung Lesion
      - Lung Opacity
      - Mass
      - Nodule
      - Normal
      - Pleural Effusion
      - Pleural Other
      - Pleural Thickening
      - Pneumomediastinum
      - Pneumonia
      - Pneumoperitoneum
      - Pneumothorax
      - Pulmonary Embolism
      - Pulmonary Hypertension
      - Rib Fracture
      - Round(ed) Atelectasis
      - Subcutaneous Emphysema
      - Support Devices
      - Tortuous Aorta
      - Tuberculosis

ckpt_path: checkpoints/fusion/epoch=08-val_loss=0.0447-val_ap=0.24103.ckpt